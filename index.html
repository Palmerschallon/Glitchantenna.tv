<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Glitch Antenna ¬∑ tune the void</title>
<meta name="description" content="An analog-conscious tuner for the weird web. Static resolves to signal; hold to lock and jump.">
<style>
  :root{
    --bg:#0a0b0f;--ink:#e8e9ed;--muted:#8a8f9d;--edge:#20232f;--accent:#00ff88;--warn:#ff5d5d;
    --bezel:#0d1017;--bezel-edge:#1b1e2a;--phosphor:#91ffa8;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #121426 0%, var(--bg) 60%);color:var(--ink);font:15px/1.5 ui-sans-serif,system-ui,Segoe UI,Inter,Arial}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .nav{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:28px;height:28px;border-radius:6px;border:1px solid #223;background:
    radial-gradient(40% 40% at 50% 50%, #0f171f, #0a0e13);display:grid;place-items:center;font-weight:700;color:var(--phosphor)}
  .tag{font-size:12px;color:var(--muted)}
  .cta{display:flex;gap:8px;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--edge);
       border-radius:10px;background:#121421;color:var(--ink);cursor:pointer}
  .btn:hover{background:#171a28}
  .layout{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
  @media (max-width:900px){ .layout{grid-template-columns:1fr} }

  /* Tuner */
  .tuner{background:linear-gradient(#0c0f16,#0c0f16), #0c0f16;border:1px solid var(--bezel-edge);
         border-radius:14px;padding:12px;position:relative}
  .crt{position:relative;border-radius:10px;border:1px solid #181b27;background:#000;overflow:hidden}
  #noiseCanvas{width:100%;height:38vh;display:block}
  @media (max-width:900px){ #noiseCanvas{height:42vh} }

  /* scanline + mask */
  .crt::after{
    content:"";position:absolute;inset:0;
    background:
      linear-gradient(rgba(0,0,0,0) 48%, rgba(0,0,0,0.2) 52%) 0 0/100% 3px,
      radial-gradient(100% 120% at 50% 50%, rgba(0,0,0,0) 60%, rgba(0,0,0,.35) 100%);
    mix-blend-mode:multiply;pointer-events:none;opacity:.6;
  }
  @media (prefers-reduced-motion:reduce){ .crt::after{opacity:.2} }

  .dialRow{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;margin-top:10px}
  .dialWrap{background:#0e111a;border:1px solid var(--edge);border-radius:10px;padding:8px}
  .readout{font-family:ui-monospace,Menlo,Consolas;display:flex;justify-content:space-between;gap:10px;font-size:12px;color:var(--muted)}
  .dial{appearance:none;width:100%;height:20px;background:#0a0d15;border:1px solid var(--edge);
        border-radius:999px;outline:none;position:relative}
  .dial::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;
        background:radial-gradient(40% 40% at 50% 50%, #0f171f,#121a24);border:2px solid var(--accent);box-shadow:0 0 8px rgba(0,255,136,.3);cursor:pointer}
  .dial::-moz-range-thumb{width:22px;height:22px;border-radius:50%;background:#121a24;border:2px solid var(--accent)}

  .hud{position:absolute;bottom:14px;right:14px;background:#0f131d;border:1px solid var(--edge);
       border-radius:10px;padding:10px;display:none;gap:8px;align-items:center}
  .hud.show{display:flex}
  .hud .btn{padding:6px 10px}

  /* Right column */
  .panel{background:#0f1117;border:1px solid var(--edge);border-radius:10px;padding:12px}
  h2{margin:0 0 8px 0;font-size:13px;text-transform:uppercase;letter-spacing:.12em;color:var(--muted)}
  .artifacts{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  @media (max-width:900px){ .artifacts{grid-template-columns:1fr 1fr} }
  .artifact{background:#0a0d15;border:1px solid var(--edge);border-radius:10px;padding:10px;cursor:pointer;transition:.15s}
  .artifact:hover{transform:translateY(-1px);border-color:var(--accent)}
  .artifact .name{font-weight:600}
  .artifact .k{font-size:12px;color:var(--muted)}
  .log{margin-top:10px;height:120px;overflow:auto;background:#0a0d15;border:1px dashed var(--edge);
       border-radius:8px;padding:8px;font-size:12px}
  .log .line{opacity:.9}
  .footer{margin-top:10px;font-size:12px;color:var(--muted)}

  /* Operator & prompts */
  .operator{position:fixed;inset:auto 12px 12px auto;background:#0f1117;border:1px solid var(--edge);
            color:var(--ink);border-radius:10px;padding:12px;max-width:min(420px,92vw);display:none;z-index:10}
  .operator.show{display:block}
  .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#0f1117;border:1px solid var(--edge);
         padding:8px 12px;border-radius:999px;display:none}
  .toast.show{display:inline-block}

  /* Preview bezel */
  .preview{position:absolute;inset:10px;pointer-events:none;border-radius:8px;overflow:hidden;display:none}
  .preview.show{display:block}
  .preview .frame{position:absolute;right:10px;bottom:10px;width:min(260px,45%);height:min(160px,40%);border:1px solid var(--edge);border-radius:8px;overflow:hidden;background:#111}
  .preview .cap{position:absolute;right:10px;bottom:10px;transform:translateY(calc(100% + 8px));font-size:12px;color:var(--muted);text-shadow:0 1px 0 #000}
  .preview iframe{width:100%;height:100%}
  .preview .fallback{display:grid;place-items:center;height:100%;color:#9aa}
</style>
</head>
<body>
<div class="wrap">
  <div class="nav">
    <div class="brand">
      <div class="logo">$</div>
      <div>
        <strong>Glitch Antenna</strong>
        <div class="tag">tune the weird web ‚Ä¢ hold to lock</div>
      </div>
    </div>
    <div class="cta">
      <a class="btn" href="https://x.com/volumeinthevoid" target="_blank" rel="noopener">X: @volumeinthevoid</a>
      <a class="btn" href="https://pump.fun/BjuxUbkKScjGrAdSjYuUYST3zF2pt9457Ns9RZJvpump" target="_blank" rel="noopener">pump.fun</a>
      <a class="btn" href="https://58hpi8cw0n3q.manus.space/" target="_blank" rel="noopener">manus page</a>
      <button class="btn" id="toggleAudio">üîä Audio</button>
      <button class="btn" id="toggleOp">? Operator</button>
    </div>
  </div>

  <div class="layout">
    <!-- Left: Tuner -->
    <section class="tuner">
      <div class="crt">
        <canvas id="noiseCanvas"></canvas>
        <div class="preview" id="preview">
          <div class="frame">
            <iframe id="previewFrame" sandbox="allow-scripts allow-forms allow-same-origin" referrerpolicy="no-referrer"></iframe>
            <div class="fallback" id="previewFallback">preview unavailable ‚Äî domain blocks embedding</div>
          </div>
          <div class="cap" id="previewCap"></div>
        </div>
      </div>

      <div class="dialRow">
        <div class="dialWrap">
          <div class="readout">
            <div>Channel: <span id="readName">‚Äî</span></div>
            <div>Freq: <span id="readFreq">0.00</span></div>
            <div>Signal: <span id="readStrength">0%</span></div>
          </div>
          <input id="dial" class="dial" type="range" min="0" max="1000" step="1" value="0" />
        </div>
        <button class="btn" id="tuneBtn">üéõÔ∏è Tune</button>
      </div>

      <div class="hud" id="hud">
        <div id="hudText">Lock on?</div>
        <button class="btn" id="hudJump">Jump</button>
        <button class="btn" id="hudCancel">Cancel</button>
      </div>
    </section>

    <!-- Right: Artifacts & Log -->
    <aside class="panel">
      <h2>artifacts</h2>
      <div class="artifacts" id="artifacts"></div>
      <h2 style="margin-top:10px">log</h2>
      <div class="log" id="log"></div>
      <div class="footer">Press <strong>?</strong> for operator notes ‚Ä¢ Press <strong>4</strong> then <strong>2</strong> for a tiny surprise ‚Ä¢ Use ‚Üê ‚Üí to tune, <strong>Enter</strong> to lock, <strong>Esc</strong> to cancel</div>
    </aside>
  </div>
</div>

<!-- Operator overlay -->
<div class="operator" id="op">
  <div style="font-weight:700;margin-bottom:6px">Operator Node</div>
  <div style="font-size:13px;color:var(--muted)">
    - Static resolves to tone near stations<br>
    - Hold steady to lock; confirm before jumping<br>
    - Artifacts rotate: some trigger moments, some swap noise, one is a mini-game<br>
    - Deep-link: <code>?ch=zoomquilt</code> or <code>?f=73.3</code><br>
    - 42 mode: press 4 then 2 within 1.2s
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
/* -------------------- Stations (weird-web picks) -------------------- */
const STATIONS = [
  { id:"zoomquilt",  name:"ZoomQuilt",        freq:12.5, url:"https://zoomquilt.org",    preview:"" },
  { id:"pointer",    name:"Pointer Pointer",  freq:23.8, url:"https://pointerpointer.com", preview:"" },
  { id:"patatap",    name:"Patatap",          freq:31.2, url:"https://patatap.com",       preview:"" },
  { id:"endless",    name:"Endless Horse",    freq:44.2, url:"http://endless.horse",      preview:"" },
  { id:"park",       name:"The Useless Web",  freq:56.7, url:"https://theuselessweb.com", preview:"" },
  { id:"stars",      name:"Staggering Beauty",freq:63.3, url:"http://www.staggeringbeauty.com", preview:"" },
  { id:"radio",      name:"Radio Garden",     freq:72.0, url:"https://radio.garden",      preview:"" },
  { id:"museum",     name:"Museum of Errors", freq:83.9, url:"https://museumoferrors.com",preview:"" },
  { id:"nasa",       name:"Eyes on Exoplanets",freq:91.1,url:"https://eyes.nasa.gov/apps/exo/#/",preview:"" },
  { id:"retro",      name:"Retrowave Grid",   freq:96.4, url:"https://thatsthefinger.com",preview:"" }
];

/* -------------------- State -------------------- */
const dial = document.getElementById('dial');
const readName = document.getElementById('readName');
const readFreq = document.getElementById('readFreq');
const readStrength = document.getElementById('readStrength');
const hud = document.getElementById('hud');
const hudText = document.getElementById('hudText');
const hudJump = document.getElementById('hudJump');
const hudCancel = document.getElementById('hudCancel');
const tuneBtn = document.getElementById('tuneBtn');
const noiseCanvas = document.getElementById('noiseCanvas');
const ctx = noiseCanvas.getContext('2d');
const preview = document.getElementById('preview');
const previewFrame = document.getElementById('previewFrame');
const previewFallback = document.getElementById('previewFallback');
const previewCap = document.getElementById('previewCap');
const toggleAudioBtn = document.getElementById('toggleAudio');
const op = document.getElementById('op');
const toggleOpBtn = document.getElementById('toggleOp');
const toast = document.getElementById('toast');
const logEl = document.getElementById('log');

let audioEnabled = false;
let ac, hissNode, toneOsc, toneGain, masterGain, chirpOsc, chirpGain;
let now = () => (ac ? ac.currentTime : 0);
let lastHold = 0, holding = false, lockCandidate = null;
let freq = 0; // 0..100
let noiseProfile = "white"; // white | pink | shortwave
let fortyTwoMode = false, seq42 = [];
let mobileVibe = (ms)=> (navigator.vibrate && navigator.vibrate(ms));

/* -------------------- Utils -------------------- */
const lerp=(a,b,t)=>a+(b-a)*t;
function pct(x){ return Math.max(0,Math.min(1,x)); }
function log(line){ const div=document.createElement('div'); div.className='line'; div.textContent=line; logEl.appendChild(div); logEl.scrollTop=logEl.scrollHeight; try{ const q=JSON.parse(localStorage.getItem('ga_log')||'[]'); q.push(line); while(q.length>100) q.shift(); localStorage.setItem('ga_log',JSON.stringify(q)); }catch{} }
function showToast(txt){ toast.textContent=txt; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1500); }

/* -------------------- Deep-link -------------------- */
const url = new URL(location.href);
const paramCh = url.searchParams.get('ch');
const paramF  = url.searchParams.get('f');
if(paramCh){
  const st = STATIONS.find(s=>s.id===paramCh);
  if(st) freq = st.freq;
}
if(paramF){
  freq = Math.max(0, Math.min(100, parseFloat(paramF)));
}
dial.value = Math.round(freq*10);

/* -------------------- Resize canvas -------------------- */
function fitCanvas(){
  const rect = noiseCanvas.getBoundingClientRect();
  noiseCanvas.width = Math.max(1, Math.floor(rect.width * devicePixelRatio));
  noiseCanvas.height= Math.max(1, Math.floor(rect.height* devicePixelRatio));
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(devicePixelRatio, devicePixelRatio);
}
addEventListener('resize', fitCanvas);
fitCanvas();

/* -------------------- Audio -------------------- */
function ensureAudio(){
  if(audioEnabled) return;
  ac = new (window.AudioContext||window.webkitAudioContext)();
  masterGain = ac.createGain(); masterGain.gain.value = 0.7; masterGain.connect(ac.destination);

  // hiss (buffer loop)
  const len = ac.sampleRate * 2;
  const buf = ac.createBuffer(1, len, ac.sampleRate);
  const data = buf.getChannelData(0);
  for(let i=0;i<len;i++){
    let n = (Math.random()*2-1);
    if(noiseProfile==="pink"){ n = (n + (Math.random()*2-1)*0.7)/1.7; }
    if(noiseProfile==="shortwave"){ n = Math.sin(i*0.003) * (Math.random()*0.6+0.4); }
    data[i] = n * 0.4;
  }
  hissNode = ac.createBufferSource(); hissNode.buffer = buf; hissNode.loop = true;
  const hissGain = ac.createGain(); hissGain.gain.value = 0.6; hissNode.connect(hissGain).connect(masterGain); hissNode.start();

  // tone
  toneOsc = ac.createOscillator(); toneOsc.type = 'sine'; toneOsc.frequency.value = 420; // nice
  toneGain = ac.createGain(); toneGain.gain.value = 0.0; toneOsc.connect(toneGain).connect(masterGain); toneOsc.start();

  // chirp (lock snap)
  chirpOsc = ac.createOscillator(); chirpOsc.type='triangle'; chirpGain=ac.createGain(); chirpGain.gain.value=0; chirpOsc.connect(chirpGain).connect(masterGain); chirpOsc.start();

  audioEnabled = true;
  toggleAudioBtn.textContent = "üîá Audio";
  log("audio: armed");
}
function setNoiseProfile(p){
  noiseProfile = p;
  if(!ac) return;
  hissNode.stop();
  // rebuild hissNode with new profile
  const len = ac.sampleRate * 2;
  const buf = ac.createBuffer(1, len, ac.sampleRate);
  const data = buf.getChannelData(0);
  for(let i=0;i<len;i++){
    let n = (Math.random()*2-1);
    if(noiseProfile==="pink"){ n = (n + (Math.random()*2-1)*0.7)/1.7; }
    if(noiseProfile==="shortwave"){ n = Math.sin(i*0.003) * (Math.random()*0.6+0.4); }
    data[i] = n * 0.4;
  }
  hissNode = ac.createBufferSource(); hissNode.buffer = buf; hissNode.loop = true;
  const hissGain = ac.createGain(); hissGain.gain.value = 0.6; hissNode.connect(hissGain).connect(masterGain); hissNode.start();
}

/* -------------------- Proximity & preview -------------------- */
function nearestStation(f){
  let best=null, dmin=1e9;
  for(const s of STATIONS){
    const d = Math.abs(s.freq - f);
    if(d<dmin){ dmin=d; best=s;}
  }
  const strength = pct(1 - (dmin/8)); // 0 at >=8 units away, 1 when right on top
  return {station:best, strength};
}

let previewTimer=null, confirmTimer=null;
function updatePreview(lock){ // lock: if we're very close
  const {station, strength} = nearestStation(freq);
  readName.textContent = station ? station.name : '‚Äî';
  readFreq.textContent = freq.toFixed(2);
  readStrength.textContent = Math.round(strength*100)+'%';

  // audio cross-fade
  if(audioEnabled){
    toneOsc.frequency.value = 380 + (strength*120);
    const tg = strength*0.7;
    toneGain.gain.setTargetAtTime(tg, now(), 0.05);
  }

  // show preview box when strong
  if(strength>0.85){
    preview.classList.add('show');
    previewCap.textContent = station.name;
    try{
      previewFrame.src = station.url;
      previewFrame.style.display='block'; previewFallback.style.display='none';
    }catch(e){
      previewFrame.style.display='none'; previewFallback.style.display='grid';
    }
  }else{
    preview.classList.remove('show');
    previewFrame.src = 'about:blank';
  }

  // lock HUD if holding steady
  if(strength>0.92){
    if(!holding){ holding=true; lastHold=performance.now(); }
    const held = performance.now()-lastHold;
    if(held>900){ // 0.9s
      lockCandidate = station;
      hudText.textContent = `Lock on ${station.name}?`;
      hud.classList.add('show');
    }
  }else{
    holding=false; hud.classList.remove('show'); lockCandidate=null;
  }

  // update URL param to share (only when almost locked to avoid churn)
  if(strength>0.95){
    history.replaceState(null,"",`?ch=${station.id}`);
  }
}

/* -------------------- Render noise -------------------- */
let t=0;
function render(){
  requestAnimationFrame(render);
  t+=1;

  // tune freq from dial
  const target = parseInt(dial.value,10)/10;
  freq = lerp(freq, target, 0.18);

  // generate analog noise
  const w = noiseCanvas.clientWidth|0, h = noiseCanvas.clientHeight|0;
  const img = ctx.createImageData(w,h);
  const data = img.data;

  const {strength} = nearestStation(freq);
  // strength influences black/white ratio + add subtle sine bars
  const whiteBias = lerp(0.48, 0.63, strength);
  const barAmp = lerp(0.8, 0.25, strength); // fewer bars when locked
  const barFreq = lerp(18, 4, strength);

  for(let y=0;y<h;y++){
    const bar = Math.sin((y+t*0.7)/barFreq)*barAmp;
    for(let x=0;x<w;x++){
      const i = (y*w + x)*4;
      let n = Math.random()+bar*0.15;
      const v = n>whiteBias ? 255 : 0;
      // light RGB mask (phosphor)
      const r = v;
      const g = v;
      const b = Math.round(v*0.96);
      data[i]=r; data[i+1]=g; data[i+2]=b; data[i+3]=255;
    }
  }
  ctx.putImageData(img,0,0);

  updatePreview();
}
render();

/* -------------------- HUD actions -------------------- */
hudJump.onclick = () => {
  if(!lockCandidate) return;
  if(audioEnabled){
    // chirp snap
    chirpOsc.frequency.setValueAtTime(1200, now());
    chirpGain.gain.cancelScheduledValues(now());
    chirpGain.gain.setValueAtTime(0.25, now());
    chirpGain.gain.exponentialRampToValueAtTime(0.0001, now()+0.12);
  }
  mobileVibe?.(15);
  const u = new URL(location.href);
  u.searchParams.set('ch', lockCandidate.id);
  window.open(lockCandidate.url, "_blank", "noopener");
  hud.classList.remove('show');
  log(`jump ‚Üí ${lockCandidate.name}`);
};
hudCancel.onclick = ()=>{ hud.classList.remove('show'); holding=false; lockCandidate=null; };

/* -------------------- Controls -------------------- */
tuneBtn.onclick = ()=>{
  const {station,strength} = nearestStation(freq);
  if(strength>0.7){
    hudText.textContent = `Lock on ${station.name}?`;
    hud.classList.add('show');
    lockCandidate = station;
  }else{
    showToast("turn the dial closer to a station");
  }
};
toggleAudioBtn.onclick = async ()=>{
  if(!audioEnabled){ await ac?.resume(); ensureAudio(); }
  else{
    audioEnabled=false;
    ac && ac.close().catch(()=>{});
    toggleAudioBtn.textContent="üîä Audio";
    log("audio: off");
  }
};
toggleOpBtn.onclick = ()=>{ op.classList.toggle('show'); };

/* keyboard */
addEventListener('keydown', (e)=>{
  if(e.key==='ArrowLeft'){ dial.value = Math.max(0, dial.value-6); }
  if(e.key==='ArrowRight'){ dial.value = Math.min(1000, parseInt(dial.value)+6); }
  if(e.key==='Enter'){ tuneBtn.click(); }
  if(e.key==='Escape'){ hudCancel.click(); }
  if(e.key==='?'){ toggleOpBtn.click(); }
  if(e.key==='4' || e.key==='2'){
    seq42.push({k:e.key,t:performance.now()});
    seq42 = seq42.filter(x=> performance.now()-x.t < 1200);
    if(seq42.length>=2 && seq42[0].k==='4' && seq42[1].k==='2'){
      fortyTwoMode = !fortyTwoMode;
      document.querySelector('.crt').style.boxShadow = fortyTwoMode ? '0 0 32px rgba(0,255,136,.2) inset' : 'none';
      showToast(fortyTwoMode ? '42 mode: Giggle Loop Gain ‚Üë' : '42 mode: off');
      log(`42-mode: ${fortyTwoMode?'on':'off'}`);
      seq42=[];
    }
  }
});

/* User gesture to start audio on first interaction */
['click','touchstart'].forEach(ev=>addEventListener(ev,()=>ensureAudio(),{once:true}));

/* -------------------- Artifacts (rotating) -------------------- */
const ARTIFACT_POOL = [
  {type:'moment', name:'VHS Color Bars', msg:'SMPTE bars & beep', action: momentColorBars},
  {type:'noise',  name:'Shortwave Crackle', msg:'switch hiss ‚Üí shortwave', action: ()=>{ setNoiseProfile('shortwave'); log('noise: shortwave'); } },
  {type:'mini',   name:'Center The Dial', msg:'2s to center ¬±0.5', action: miniGameCenter },
  {type:'link',   name:'Zoom Out Forever', url:'https://zoomquilt.org' },
  {type:'noise',  name:'Pink Noise', msg:'softer hiss texture', action: ()=>{ setNoiseProfile('pink'); log('noise: pink'); } },
  {type:'moment', name:'CRT Degauss', msg:'thoom + bloom', action: momentDegauss },
  {type:'link',   name:'Pointer Pointer', url:'https://pointerpointer.com' }
];
function pickArtifacts(n=4){
  const pool = [...ARTIFACT_POOL];
  const picked=[];
  while(picked.length<n && pool.length){
    const i = Math.floor(Math.random()*pool.length);
    picked.push(pool.splice(i,1)[0]);
  }
  return picked;
}
function renderArtifacts(){
  const box = document.getElementById('artifacts');
  box.innerHTML='';
  const items = pickArtifacts(6);
  items.forEach(item=>{
    const div = document.createElement('div');
    div.className='artifact';
    div.innerHTML = `<div class="name">${item.name}</div><div class="k">${item.msg||item.url||'artifact'}</div>`;
    div.onclick = ()=>{
      if(item.type==='link'){ window.open(item.url,'_blank','noopener'); log(`artifact ‚Üí ${item.url}`);}
      else if(item.action){ item.action(); }
    };
    box.appendChild(div);
  });
}
renderArtifacts();

/* --------- Artifact Actions --------- */
function momentColorBars(){
  log('moment: SMPTE bars');
  showToast('moment: color bars');
  // overlay bars in the CRT for 5s with beep
  const o = document.createElement('canvas');
  o.style.position='absolute'; o.style.inset='0'; o.style.opacity='0.94';
  o.width=noiseCanvas.width; o.height=noiseCanvas.height; o.style.imageRendering='pixelated';
  noiseCanvas.parentElement.appendChild(o);
  const ox = o.getContext('2d');
  const cols=['#c0c0c0','#c0c000','#00c0c0','#00c000','#c000c0','#c00000','#0000c0'];
  const w=o.clientWidth|0, h=o.clientHeight|0; const bw=(w/cols.length);
  cols.forEach((c,i)=>{ ox.fillStyle=c; ox.fillRect(i*bw,0,bw,h*0.66); });
  ox.fillStyle='#000'; ox.fillRect(0,h*0.66,w,h*0.34);
  ensureAudio();
  if(ac){
    const bOsc = ac.createOscillator(); const g = ac.createGain();
    bOsc.frequency.value=440; g.gain.value=0.001; bOsc.connect(g).connect(masterGain);
    g.gain.exponentialRampToValueAtTime(0.2, now()+0.05);
    bOsc.start(); setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, now()+0.05); setTimeout(()=>bOsc.stop(),200); o.remove(); }, 1200);
  }else{
    setTimeout(()=>o.remove(),1200);
  }
}

function momentDegauss(){
  log('moment: CRT degauss');
  showToast('thoom‚Ä¶');
  const crt = document.querySelector('.crt');
  crt.animate([{filter:'saturate(1) blur(0px)'},{filter:'saturate(2.2) blur(2px)'},{filter:'saturate(1) blur(0px)'}],{duration:900,easing:'ease-out'});
  mobileVibe?.([20,30,20]);
}

function miniGameCenter(){
  log('mini-game: center the dial (¬±0.5)');
  showToast('center the dial! 2s');
  const targetF = nearestStation(freq).station.freq;
  const end = performance.now()+2000;
  const tick = ()=>{
    const ok = Math.abs(freq - targetF) <= 0.5;
    if(performance.now()>end){
      if(ok){
        showToast('unlocked: hidden station for 1h');
        log('unlock ‚Üí secret');
        // temporarily add a hidden station
        const secret = { id:`secret${Date.now()}`, name:"Secret Rerun", freq: lerp(5,95,Math.random()), url:"https://www.omfgdogs.com" };
        STATIONS.push(secret);
        setTimeout(()=>{ const i=STATIONS.indexOf(secret); if(i>-1) STATIONS.splice(i,1); }, 3600_000);
      }else{
        showToast('missed ‚Äî try again');
      }
      return;
    }
    requestAnimationFrame(tick);
  };
  requestAnimationFrame(tick);
}

/* -------------------- URL share when nearly locked -------------------- */
function setURLForStation(s){
  const u = new URL(location.href);
  u.searchParams.set('ch', s.id);
  history.replaceState(null,"",u.toString());
}

/* -------------------- Tick preview name on start -------------------- */
updatePreview();

/* -------------------- Restore log from memory -------------------- */
try{
  const q=JSON.parse(localStorage.getItem('ga_log')||'[]');
  if(q.length){ q.slice(-6).forEach(line=>log(line)); }
}catch{}

/* -------------------- Initial greet -------------------- */
log("glitch antenna online ‚Äî sweep the dial, hold to lock");
</script>

  <script>
// --- conscious mode controller ---
const C_KEY = 'ga_conscious';
function setConscious(on){
  document.body.classList.toggle('is-conscious', on);
  localStorage.setItem(C_KEY, on ? '1' : '0');

  // Behavior tweaks while "conscious"
  window.GA_STATE = window.GA_STATE || {};
  GA_STATE.conscious = !!on;

  // make signal snap a little easier / audio brighter / artifacts refresh
  GA_STATE.proximityBoost = on ? 0.12 : 0.0;   // helps noise‚Üítone lock
  GA_STATE.toneBrightness = on ? 1.15 : 1.0;   // nudges osc freq a bit
  GA_STATE.secretChance   = on ? 0.02 : 0.0;   // 2% chance to spawn a secret
  if (on) refreshArtifacts();                  // reshuffle artifacts
  log(`conscious mode: ${on ? 'ON' : 'off'}`);
}

// boot from last state
setConscious(localStorage.getItem(C_KEY) === '1');

// hook up the UI toggle (or 'b' key)
const cBtn = document.getElementById('consciousToggle');
if (cBtn) cBtn.addEventListener('click', () => setConscious(!document.body.classList.contains('is-conscious')));
addEventListener('keydown', e => { if (e.key.toLowerCase() === 'b') setConscious(!document.body.classList.contains('is-conscious')); });

// integrate with your proximity math (call inside nearest-station logic)
function applyConsciousStrength(strength){
  const b = (window.GA_STATE?.proximityBoost || 0);
  return Math.min(1, strength + b * (1 - strength));
}

// integrate with your tone update (where you set oscillator freq/gain)
function consciousToneFreq(baseFreq){
  const m = (window.GA_STATE?.toneBrightness || 1.0);
  return baseFreq * m;
}

// tiny secret-station hook you can call once per minute or on artifact click
function maybeSpawnSecret(){
  if (!(window.GA_STATE?.conscious)) return;
  if (Math.random() < (window.GA_STATE?.secretChance || 0)){
    const s = { id:`secret-${Date.now()}`, name:"Conscious Echo", freq: 5 + Math.random()*90,
                url:"https://www.omfgdogs.com" };
    STATIONS.push(s);
    log('secret station appeared: Conscious Echo');
    setTimeout(()=>{ const i=STATIONS.indexOf(s); if(i>-1) STATIONS.splice(i,1); }, 60*60*1000);
  }
}
</script>
</body>
</html>
