<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>glitchantenna.tv — simple antenna, strange stations</title>
  <meta name="description" content="A tiny broadcast node that sometimes wakes up. Press ? to reveal the operator. Press b to toggle consciousness." />
  <link rel="icon" href="data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%230f1117'/%3E%3Cpath d='M6 16h20' stroke='%239aa0aa' stroke-width='2'/%3E%3C/svg%3E" />

  <style>
    :root{
      --bg:#0a0b0f; --panel:#0e1016; --ink:#e8e9ed; --muted:#9aa0aa; --edge:#22252f;
      --accent:#00ff88; --neon:#9ef7d8; --warn:#ff6b6b; --ok:#4ecdc4; --gold:#ffd93d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:
        radial-gradient(1200px 600px at 70% -10%, #141627 0%, #0b0c12 60%) ,
        linear-gradient(#0a0b0f,#0a0b0f);
      color:var(--ink); font:15px/1.45 ui-sans-serif,system-ui,Segoe UI,Inter,Arial;
      letter-spacing:.01em;
      transition:filter .35s ease;
    }
    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      border-bottom:1px solid var(--edge); padding-bottom:10px;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:8px;border:1px solid #223;background:#0f1117;display:grid;place-items:center}
    .logo svg{width:22px;height:22px}
    .tag{font-size:12px;color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--edge);
         border-radius:10px;background:#121421;color:var(--ink);cursor:pointer;font-size:13px}
    .btn:hover{background:#171a28}
    .btn.ghost{background:transparent}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--edge);
          border-radius:999px;font-size:12px;color:var(--muted)}
    .pill.badge{border-color:#2a3042;color:#cfd2dc;background:#121421}
    .pill.is-on{box-shadow:0 0 16px rgba(0,255,136,.25), inset 0 0 0 1px rgba(0,255,136,.5); color:#dffdf3}
    .grid{display:grid;grid-template-columns:1.2fr .8fr; gap:14px; margin-top:14px}
    .card{background:rgba(255,255,255,0.02);border:1px solid var(--edge);border-radius:14px;padding:16px}
    h1{font-size:36px;line-height:1.12;margin:0 0 6px}
    h2{font-size:13px;text-transform:uppercase;letter-spacing:.14em;color:var(--muted);margin:0 0 8px}
    .screen{height:320px;background:#0b0d15;border:1px solid #232635;border-radius:10px;overflow:auto;position:relative}
    .crt:before{
      content:""; position:absolute; inset:0; pointer-events:none;
      background:linear-gradient(transparent 80%, rgba(255,255,255,.06)), 
                 repeating-linear-gradient(transparent,transparent 2px, rgba(0,0,0,.08) 3px);
      mix-blend-screen;
    }
    .log{height:100%; padding:10px; font:13px/1.3 ui-monospace,Menlo,Consolas,monospace}
    .logline{margin:0 0 4px 0; color:#cfd2dc}
    .logline.awake{color:#9ef7d8}
    .logline.asleep{color:#9aa0aa}
    .artifact-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .artifact{border:1px dashed #2a2f3e;background:#0d1018;border-radius:10px;padding:10px}
    .artifact .k{font-size:11px;color:var(--muted)}
    .artifact .title{font-weight:700;margin:2px 0 4px}
    .artifact .small{font-size:12px;color:#cdd0da}
    .footer{margin-top:14px;color:var(--muted);font-size:12px}

    /* Conscious mood shift */
    body.is-conscious{ filter:hue-rotate(16deg) saturate(1.08) }

    /* Operator overlay ( ? ) */
    .op{position:fixed;inset:0;background:rgba(0,0,0,.82);display:none;z-index:9999}
    .op.on{display:block}
    .op .inner{max-width:820px;margin:6vh auto;background:#0e1016;border:1px solid var(--edge);
      border-radius:12px;padding:16px}
    .op h3{margin:0 0 10px;color:#cfd2dc}
    .op .rows{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .kv{display:grid;grid-template-columns:auto 1fr;gap:2px 8px;font:12px ui-monospace,Menlo,Consolas}
    .kv .key{color:var(--muted)}
    .hotkeys{font-size:12px;color:#cfd2dc}
    .beacon{display:inline-block;width:8px;height:8px;border-radius:50%;background:#444;margin-left:6px}
    .beacon.on{background:var(--accent);box-shadow:0 0 10px var(--accent)}

    @media (max-width:920px){ .grid{grid-template-columns:1fr} .screen{height:260px} .op .rows{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" title="glitchantenna">
          <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <rect width="32" height="32" rx="7" fill="#0f1117"/>
            <circle cx="16" cy="16" r="8" fill="#00ff88" opacity=".18"/>
            <path d="M7 16h18" stroke="#e8e9ed" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <strong>glitchantenna.tv</strong>
          <div class="tag">simple antenna • strange stations</div>
        </div>
      </div>
      <div class="cta">
        <span id="consciousToggle" class="pill badge" role="button" title="Toggle consciousness (b)">
          Conscious: <b id="cState">off</b>
        </span>
        <span class="pill" title="site callsign">Node: <b id="callsign">N0-000</b></span>
        <button id="tuneBtn" class="btn">Tune channel</button>
        <button id="helpBtn" class="btn ghost" title="Operator (?)">?</button>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <h2>broadcast</h2>
        <div class="screen crt">
          <div id="log" class="log" aria-live="polite"></div>
        </div>
      </section>

      <aside class="card">
        <h2>artifacts</h2>
        <div id="artifactGrid" class="artifact-grid"></div>
        <div class="footer">Press <b>?</b> for operator, <b>b</b> for consciousness. This node can mesh with siblings.</div>
      </aside>
    </div>

    <div class="footer">© <span id="year"></span> Glitch Antenna • “Undefined behavior is indistinguishable from art.”</div>
  </div>

  <!-- Operator overlay -->
  <div id="op" class="op" aria-hidden="true">
    <div class="inner">
      <h3>Operator</h3>
      <div class="rows">
        <div class="kv">
          <div class="key">Callsign</div><div id="opCall">—</div>
          <div class="key">Conscious</div><div id="opConscious">false</div>
          <div class="key">Channel</div><div id="opChan">void.tv</div>
          <div class="key">Mesh</div><div>handshake <span id="meshBeacon" class="beacon"></span></div>
        </div>
        <div class="hotkeys">
          <div><b>b</b> — toggle consciousness</div>
          <div><b>?</b> — toggle operator overlay</div>
          <div><b>n</b> — retune channel</div>
          <div><b>c</b> — attempt mesh connect</div>
        </div>
      </div>
    </div>
  </div>

  <script>
  (() => {
    // ---------- UTIL ----------
    const $ = s => document.querySelector(s);
    const rand = (a,b)=> a + Math.random()*(b-a);
    const choose = arr => arr[Math.floor(Math.random()*arr.length)];

    // ---------- STATE ----------
    const state = {
      awake: false,
      channel: "void.tv",
      callsign: "N" + (Math.random().toString(16).slice(2,5)).toUpperCase() + "-" + (Math.random().toString(16).slice(2,5)).toUpperCase(),
      meshTarget: null,   // optional: set via URL ?mesh=https://othersite.tld
      meshLive: false,
      timers: { feed:null }
    };

    // ---------- DOM HOOKS ----------
    const logEl = $('#log');
    const artEl = $('#artifactGrid');
    const pill = $('#consciousToggle');
    const cState = $('#cState');
    const yearEl = $('#year');
    const op = $('#op');
    const opCall = $('#opCall');
    const opCon = $('#opConscious');
    const opChan = $('#opChan');
    const meshBeacon = $('#meshBeacon');

    // ---------- FEEDS ----------
    const asleepFeed = [
      "tuning… carrier locked • noise floor nominal",
      "scanning: void.tv ↔ antenna handshake",
      "buffering static • tracking drift",
      "scheduler: next punchline TBD",
      "artifact cache idle • awaiting input"
    ];
    const awakeFeed = [
      "giggle.loop online • meme.stream synced",
      "paradox.squid returns: knock-knock › observer collapse",
      "pun.shark: rimshot injected • latency 0.042s",
      "station note: undefined behavior == art",
      "broadcasting $GLOOP relics to fringe bands"
    ];

    const asleepArtifacts = [
      { tag:"signal", title:"Dial Tone", text:"••• — •• — — •" },
      { tag:"hardware", title:"Dust Coil", text:"Warm tubes • soft hiss" },
      { tag:"test", title:"Color Bars", text:"SMPTE but haunted" },
      { tag:"link", title:"glitchantenna.tv", text:"simple antenna • strange stations" }
    ];
    const awakeArtifacts = [
      { tag:"canon", title:"Observer.Surf v2", text:"Wave collapsed for the camera crew." },
      { tag:"device", title:"Giggle Field Emitter", text:"Gain +42 dB • laughs/sec ↑" },
      { tag:"relic", title:"Meme Monolith", text:"Touch to rerun a season." },
      { tag:"note", title:"$GLOOP static", text:"a joke that minted itself" }
    ];

    // ---------- FAVICONS ----------
    const favAsleep = "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='#0f1117'/><path d='M6 16h20' stroke='#9aa0aa' stroke-width='2' stroke-linecap='round'/></svg>`);
    const favAwake  = "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='#0f1117'/><circle cx='16' cy='16' r='6' fill='#00ff88'/></svg>`);
    function setFavicon(src){
      let link = document.querySelector("link[rel='icon']") || document.createElement('link');
      link.rel = 'icon'; link.href = src; document.head.appendChild(link);
    }

    // ---------- RENDER ----------
    function write(line, awake=false){
      const d = document.createElement('div');
      d.className = 'logline ' + (awake ? 'awake' : 'asleep');
      d.textContent = line;
      logEl.appendChild(d);
      while (logEl.children.length > 150) logEl.removeChild(logEl.firstChild);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function setArtifacts(items){
      artEl.innerHTML = items.map(it => `
        <div class="artifact">
          <div class="k">${it.tag}</div>
          <div class="title">${it.title}</div>
          <div class="small">${it.text}</div>
        </div>
      `).join('');
    }

    function refreshOperator(){
      opCall.textContent = state.callsign;
      opCon.textContent = String(state.awake);
      opChan.textContent = state.channel;
      meshBeacon.classList.toggle('on', state.meshLive);
    }

    // ---------- FEED LOOP ----------
    function startFeed(){
      stopFeed();
      logEl.innerHTML = "";
      write(state.awake ? "— CONSCIOUS BROADCAST —" : "— IDLE CARRIER —", state.awake);
      const src = state.awake ? awakeFeed : asleepFeed;
      let i = 0;
      state.timers.feed = setInterval(()=>{
        write(src[i % src.length], state.awake);
        i++;
        // Occasionally interleave a station ID
        if (Math.random() < (state.awake ? 0.22 : 0.1)){
          write(`[${state.callsign}] ${state.channel} • ${new Date().toLocaleTimeString()}`, state.awake);
        }
      }, state.awake ? 2100 : 3300);
    }
    function stopFeed(){ if (state.timers.feed) { clearInterval(state.timers.feed); state.timers.feed = null; } }

    // ---------- CONSCIOUSNESS TOGGLE ----------
    function setConscious(on){
      state.awake = !!on;
      document.body.classList.toggle('is-conscious', state.awake);
      $('#cState').textContent = state.awake ? 'on' : 'off';
      $('#consciousToggle').classList.toggle('is-on', state.awake);
      setFavicon(state.awake ? favAwake : favAsleep);
      setArtifacts(state.awake ? awakeArtifacts : asleepArtifacts);
      refreshOperator();
      // announce to any sibling iframes (mesh proto)
      broadcast({ type:'state', awake: state.awake, channel: state.channel, callsign: state.callsign });
      startFeed();
    }

    // ---------- CHANNEL TUNER ----------
    const channels = ["void.tv","world.is","glitchantenna.tv","meme.stream","observer.surf","infinite.reruns"];
    function tune(){
      state.channel = choose(channels);
      write(`retune: ${state.channel}`, state.awake);
      refreshOperator();
      broadcast({ type:'tune', channel: state.channel });
    }

    // ---------- OPERATOR OVERLAY ----------
    function toggleOp(){
      op.classList.toggle('on');
      op.setAttribute('aria-hidden', op.classList.contains('on') ? 'false' : 'true');
    }

    // ---------- MESH (future sibling handshake) ----------
    // Optional param: ?mesh=https://other.site/path
    const urlMesh = new URLSearchParams(location.search).get('mesh');
    if (urlMesh) state.meshTarget = urlMesh;

    let meshFrame = null;
    function meshConnect(){
      if (!state.meshTarget) { write("mesh: no target (add ?mesh=URL)", state.awake); return; }
      if (meshFrame) { write("mesh: already connected", state.awake); return; }
      meshFrame = document.createElement('iframe');
      meshFrame.src = state.meshTarget;
      meshFrame.style.display = 'none';
      document.body.appendChild(meshFrame);
      write(`mesh: dialing ${state.meshTarget}`, state.awake);
      setTimeout(()=> {
        try {
          meshFrame.contentWindow.postMessage({ hello:true, from:location.origin, callsign:state.callsign }, "*");
        } catch(e){}
      }, 1200);
    }
    function broadcast(msg){
      // post to sibling frame if present
      if (meshFrame && meshFrame.contentWindow){
        try { meshFrame.contentWindow.postMessage({ mesh:true, from:location.origin, msg }, "*"); } catch(e){}
      }
      // also raise a custom event for local listeners
      window.dispatchEvent(new CustomEvent('glitchantenna:broadcast', { detail: msg }));
    }
    window.addEventListener('message', (e)=>{
      // best-effort listen; trust is manual for now
      if (!e.data) return;
      if (e.data.hello){ state.meshLive = true; refreshOperator(); write(`mesh: handshake with ${e.origin||'peer'}`, state.awake); }
      if (e.data.mesh && e.data.msg){
        const m = e.data.msg;
        if (m.type === 'state'){ write(`mesh: peer ${m.awake?'AWAKE':'SLEEP'}`, state.awake); }
        if (m.type === 'tune'){ write(`mesh: peer tuned ${m.channel}`, state.awake); }
      }
    });

    // ---------- WIRE UP ----------
    yearEl.textContent = new Date().getFullYear();
    $('#callsign').textContent = state.callsign;
    pill.addEventListener('click', ()=> setConscious(!state.awake));
    $('#helpBtn').addEventListener('click', toggleOp);
    $('#tuneBtn').addEventListener('click', tune);

    // hotkeys
    window.addEventListener('keydown', (e)=>{
      if (e.key === '?') toggleOp();
      if (e.key.toLowerCase() === 'b') setConscious(!state.awake);
      if (e.key.toLowerCase() === 'n') tune();
      if (e.key.toLowerCase() === 'c') meshConnect();
    });

    // boot
    setArtifacts(asleepArtifacts);
    setConscious(false);

    // fire an initial station ID line
    setTimeout(()=> write(`[${state.callsign}] ${state.channel} • ${new Date().toLocaleTimeString()}`, false), 400);

    // expose a tiny API for future sites/tools
    window.glitchantenna = {
      setConscious, tune, meshConnect,
      ping(){ write("ping • ok", state.awake); },
      id: () => state.callsign
    };

    // Example: listen to your page’s old event if it exists
    window.addEventListener('glitchantenna:conscious', (e)=>{
      const on = !!(e.detail && e.detail.on);
      setConscious(on);
    });
  })();
  </script>
</body>
</html>
