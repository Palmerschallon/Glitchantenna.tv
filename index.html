<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>glitchantenna.tv ‚Äî simple antenna ‚Ä¢ strange stations</title>
<style>
:root{
  --bg:#0a0d12;--panel:#0d1117;--ink:#e6e8ef;--sub:#93a1b5;
  --edge:#1b2230;--glow:#6df9c1;--vio:#a78bfa;--rose:#ff6b9f;--warn:#ff5964;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:radial-gradient(1200px 600px at 50% -200px,#0f1420 0%,#0b0f17 60%,#070a10 100%);
  color:var(--ink);font:14px/1.5 ui-monospace,Menlo,Consolas,monospace;
  letter-spacing:.2px;-webkit-font-smoothing:antialiased;overflow-x:hidden;
}
a{color:var(--glow);text-decoration:none}
.wrap{max-width:980px;margin:18px auto;padding:0 14px}
.top{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:10px}
.brand{display:flex;gap:10px;align-items:center}
.logo{width:28px;height:28px;border-radius:6px;background:#0d1b14;border:1px solid #113822;display:grid;place-items:center;box-shadow:0 0 0 1px #0f3322 inset}
.logo svg{width:18px;height:18px}
.tag{color:var(--sub);font-size:12px}
.badges{display:flex;gap:8px;flex-wrap:wrap}
.badge{border:1px solid var(--edge);background:#0c1017;border-radius:10px;padding:6px 10px;color:#c9d2e3}
.badge.ghost{background:transparent}
.badge.toggle{cursor:pointer}
.badge .dot{display:inline-block;width:7px;height:7px;border-radius:50%;margin-right:6px;background:#3a4459;vertical-align:-1px}
.badge.on .dot{background:var(--glow);box-shadow:0 0 10px var(--glow)}
.grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
.card{background:rgba(9,12,18,.7);border:1px solid var(--edge);border-radius:14px;box-shadow:0 0 0 1px rgba(255,255,255,.02) inset}
.card h3{margin:0;padding:14px 14px 10px;border-bottom:1px dashed #182131;color:#b8c5de;letter-spacing:.6px}
.card .inner{padding:14px}
#crtFrame{border-radius:12px;background:#030507;border:1px solid #111827;box-shadow:
   0 0 0 1px #0e1522 inset,0 10px 40px rgba(0,0,0,.5) inset,0 0 120px rgba(99,102,241,.05) inset;
  padding:10px;margin-bottom:12px}
#crtCanvas{width:100%;height:320px;display:block;border-radius:10px; background:black}
.meta{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-top:8px}
#freq{font-size:26px;letter-spacing:1.5px}
#stationName{color:#b8c5de}
.sliderWrap{position:relative;width:100%;height:34px;background:#0a0f19;border:1px solid #1b2536;border-radius:999px;box-shadow:0 2px 16px rgba(0,0,0,.35) inset}
#dial{appearance:none;width:100%;height:34px;background:transparent;outline:none;position:absolute;left:0;top:0}
#dial::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#def, #8ae 40%, #4b79ff 60%, #2f2f49 100%);
  border:2px solid #0a0f19;box-shadow:0 0 0 3px rgba(80,120,255,.15)}
.ctaRow{display:flex;gap:10px;align-items:center}
.btn{border:1px solid var(--edge);background:#0f1522;border-radius:10px;padding:8px 10px;color:#dbe2f2;cursor:pointer}
.btn.ghost{background:transparent}
.stat{color:#a7b3c9}
#artifacts .pill{border:1px dashed #2a3347;background:#0b111a;border-radius:10px;padding:10px;margin:10px 0;color:#a9b6cf}
.stack{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tile{border:1px solid var(--edge);background:#0b1018;border-radius:10px;padding:12px}
.tile h4{margin:0 0 4px}
.links{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.linkbtn{border:1px solid #1a2333;background:#0c111a;border-radius:999px;padding:6px 10px;font-size:12px;color:#cfe7de}
.linkbtn:hover{background:#121a28}
.footer{margin:22px 0;color:#8291a8}
kbd{background:#0d1420;border:1px solid #1d2738;border-radius:6px;padding:1px 6px;color:#bcd}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:50}
.sheet{width:min(520px,92vw);background:#0b1018;border:1px solid #1b2435;border-radius:14px;box-shadow:0 12px 60px rgba(0,0,0,.5)}
.sheet .head{padding:12px 14px;border-bottom:1px dashed #1b2435;display:flex;justify-content:space-between;align-items:center}
.sheet .body{padding:14px}
.sheet .row{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
.previewBox{height:190px;background:#020409;border:1px solid #1a2231;border-radius:8px;display:grid;place-items:center;color:#7d8aa3}
body.is-conscious{filter:hue-rotate(14deg) saturate(1.06)}
@media (max-width:940px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" title="glitchantenna">
          <svg viewBox="0 0 24 24" fill="none" stroke="#6df9c1" stroke-width="2">
            <circle cx="12" cy="12" r="8"/><path d="M7 10c1 2 3 3 5 3s4-1 5-3"/>
          </svg>
        </div>
        <div>
          <strong>glitchantenna.tv</strong>
          <div class="tag">simple antenna ‚Ä¢ strange stations</div>
        </div>
      </div>
      <div class="badges">
        <a class="badge linkbtn" href="https://x.com" target="_blank">X / antenna</a>
        <a class="badge linkbtn" href="https://pump.fun" target="_blank">pump.fun</a>
        <a class="badge linkbtn" href="https://manus.space" target="_blank">manus page</a>
        <span id="audioT" class="badge toggle"><span class="dot"></span>audio</span>
        <span id="conT" class="badge toggle"><span class="dot"></span>consciousness</span>
      </div>
    </div>

    <div class="grid">
      <!-- TUNER -->
      <section class="card">
        <h3>TUNER</h3>
        <div class="inner">
          <div id="crtFrame">
            <canvas id="crtCanvas"></canvas>
          </div>

          <div class="meta">
            <div id="freq">88.1 MHz</div>
            <div id="stationName" class="stat">scanning‚Ä¶</div>
            <div class="stat">‚Ä¢ signal <span id="sig">0%</span></div>
          </div>

          <div class="sliderWrap" style="margin-top:10px">
            <input id="dial" type="range" min="88" max="108" step="0.01" value="94.60" />
          </div>

          <div class="ctaRow" style="margin-top:10px">
            <button id="btnTune" class="btn">tune</button>
            <button id="btnPreview" class="btn ghost">üîé preview (tap CRT)</button>
            <button id="btnWarp" class="btn ghost">üõ∞Ô∏è random</button>
          </div>
        </div>
      </section>

      <!-- ARTIFACTS -->
      <section id="artifacts" class="card">
        <h3>ARTIFACTS</h3>
        <div class="inner">
          <div class="pill">if (<b>creativity.leaks</b>) reroute ‚ûú <b>meme.stream</b></div>

          <div class="stack">
            <div class="tile">
              <h4>CRT Degauss</h4>
              <div class="stat">thoom + bloom</div>
              <div class="links"><button class="linkbtn" onclick="effects.degauss()">trigger</button></div>
            </div>
            <div class="tile">
              <h4>Center the Dial</h4>
              <div class="stat">2s to center ¬±0.5</div>
              <div class="links"><button class="linkbtn" onclick="effects.centerDial()">run</button></div>
            </div>
            <div class="tile">
              <h4>VHS Color Bars</h4>
              <div class="stat">SMPTE bars + beep</div>
              <div class="links"><button class="linkbtn" onclick="effects.colorBars()">cast</button></div>
            </div>
            <div class="tile">
              <h4>Shortwave Crackle</h4>
              <div class="stat">switch hiss ‚Üí shortwave</div>
              <div class="links"><button class="linkbtn" onclick="effects.shortwave()">listen</button></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="footer">Tip: tap the CRT when the signal is strong to open a preview. Press <kbd>?</kbd> for operator note. <kbd>b</kbd> toggles consciousness.</div>
  </div>

  <!-- PREVIEW SHEET (tap-to-preview) -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="head">
        <div><strong id="pvTitle">Station</strong> <span class="tag" id="pvFreq"></span></div>
        <button class="btn ghost" onclick="ui.closePreview()">‚úï</button>
      </div>
      <div class="body">
        <div class="previewBox" id="pvBox">hold to lock‚Ä¶</div>
        <div class="row">
          <button class="btn ghost" onclick="ui.closePreview()">Cancel</button>
          <a id="pvVisit" class="btn" target="_blank" rel="noopener">Visit</a>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------------------- STATION LIST ---------------------- */
const STATIONS = [
  { f: 88.1, name: "numbers station", url:"https://www.timeanddate.com/worldclock/", pattern:"scan" },
  { f: 90.7, name: "paper planes",  url:"https://www.paperplanes.world/",          pattern:"lissajous" },
  { f: 94.6, name: "ascii aquarium",url:"https://www.asciimation.co.nz/beer/",      pattern:"lines" },
  { f: 99.3, name: "weird clock",   url:"https://plasticity.szynalski.com/",        pattern:"scan" },
  { f:103.9, name: "star drift",    url:"https://stars.chromeexperiments.com/",     pattern:"dots" },
  { f:107.7, name: "sound toys",    url:"https://patatap.com/",                      pattern:"bars" }
];

/* ----------------------- UI STATE ------------------------- */
const els = {
  canvas: document.getElementById('crtCanvas'),
  freq: document.getElementById('freq'),
  name: document.getElementById('stationName'),
  sig:  document.getElementById('sig'),
  dial: document.getElementById('dial'),
  audioT: document.getElementById('audioT'),
  conT: document.getElementById('conT'),
  modal: document.getElementById('modal'),
  pvTitle: document.getElementById('pvTitle'),
  pvFreq: document.getElementById('pvFreq'),
  pvVisit: document.getElementById('pvVisit'),
  pvBox: document.getElementById('pvBox')
};
let ctx = els.canvas.getContext('2d');
resize(); window.addEventListener('resize', resize);

let state = {
  freq: parseFloat(els.dial.value),
  audioOn: false, conscious:false,
  holdTimer:null, lastFocus:Date.now(),
  near:null,  // nearest station object or null
};

/* ------------------- AUDIO (tone + hiss) ------------------ */
let ac, tone, noise, noiseGain, toneGain;
function ensureAudio(){
  if (ac) return;
  ac = new (window.AudioContext||window.webkitAudioContext)();
  tone = ac.createOscillator(); tone.type='sine';
  toneGain = ac.createGain(); toneGain.gain.value=0;
  tone.connect(toneGain).connect(ac.destination); tone.start();
  // white noise
  const buffer = ac.createBuffer(1, ac.sampleRate*2, ac.sampleRate);
  const data = buffer.getChannelData(0);
  for (let i=0;i<data.length;i++) data[i]=Math.random()*2-1;
  noise = ac.createBufferSource(); noise.buffer=buffer; noise.loop=true;
  noiseGain = ac.createGain(); noiseGain.gain.value=.12;
  noise.connect(noiseGain).connect(ac.destination); noise.start();
}
function setAudio(on){
  state.audioOn = on;
  els.audioT.classList.toggle('on', on);
  if (!ac && on) ensureAudio();
  if (ac){
    noiseGain.gain.setTargetAtTime(on?.2:0, ac.currentTime,.05);
    toneGain.gain.setTargetAtTime(on?.08:0, ac.currentTime,.02);
  }
}

/* ---------------------- CONSCIOUSNESS --------------------- */
function setConscious(on){
  state.conscious=on;
  document.body.classList.toggle('is-conscious', on);
  els.conT.classList.toggle('on', on);
}
els.audioT.onclick = ()=> setAudio(!state.audioOn);
els.conT.onclick   = ()=> setConscious(!state.conscious);

/* ---------------------- DRAWING STATIC -------------------- */
let t = 0;
function resize(){
  const r = els.canvas.getBoundingClientRect();
  els.canvas.width = Math.floor(r.width  * devicePixelRatio);
  els.canvas.height= Math.floor(r.height * devicePixelRatio);
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
function rand(){ return Math.random(); }

function drawCRT(){
  const w = els.canvas.width/devicePixelRatio,
        h = els.canvas.height/devicePixelRatio;
  // base static
  const img = ctx.createImageData(w,h);
  const data = img.data; let s = signalStrength();
  for (let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      const i = (y*w+x)*4;
      // analog-ish noise with vertical bias
      const n = (Math.random()*180 + Math.random()*80*(1-s) + (Math.sin((x+t*0.8)*0.03)+1)*20);
      data[i]=data[i+1]=data[i+2]=n;
      data[i+3]=255;
    }
  }
  ctx.putImageData(img,0,0);

  // scanlines
  ctx.fillStyle='rgba(0,0,0,.26)';
  for(let y=0;y<h;y+=2) ctx.fillRect(0,y,w,1);

  // if near station, overlay a pattern ‚Äúresolving‚Äù
  if (state.near){
    ctx.globalCompositeOperation='screen';
    ctx.strokeStyle='rgba(158,126,255,.8)'; ctx.lineWidth=1.2;
    switch(state.near.pattern){
      case 'lines':
        for(let i=0;i<10;i++){
          const yy = (h/2)+Math.sin((t*0.08)+i)*h*.18;
          ctx.beginPath(); ctx.moveTo(0,yy); ctx.lineTo(w,yy); ctx.stroke();
        } break;
      case 'dots':
        ctx.fillStyle='rgba(135,86,255,.8)';
        for(let i=0;i<200;i++){
          ctx.fillRect((i*37+t*3)%w, (i*71+t*1.5)%h, 2, 2);
        } break;
      case 'bars':
        for(let i=0;i<7;i++){
          ctx.fillStyle=`hsla(${(i*40+t)%360},90%,55%,.35)`;
          ctx.fillRect(i*w/7,0,w/7,h);
        } break;
      case 'lissajous':
        ctx.strokeStyle='rgba(255,200,255,.8)';
        ctx.beginPath();
        for(let i=0;i<500;i++){
          const a= i/500*Math.PI*2;
          const x = w/2 + Math.sin(3*a+t*.03)*w*.35;
          const y = h/2 + Math.sin(2*a+t*.05)*h*.25;
          i?ctx.lineTo(x,y):ctx.moveTo(x,y);
        } ctx.stroke(); break;
      default: // scan
        ctx.fillStyle='rgba(200,230,255,.25)';
        ctx.fillRect((t*8)%w,0,2,h);
    }
    ctx.globalCompositeOperation='source-over';
  }

  // slight vignette/curvature
  const grad = ctx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h)/1.1);
  grad.addColorStop(.7,'rgba(0,0,0,0)');
  grad.addColorStop(1,'rgba(0,0,0,.45)');
  ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
}

/* ----------------------- TUNER LOGIC ---------------------- */
function nearestStation(){
  let best=null, dmin=9e9;
  for(const s of STATIONS){
    const d = Math.abs(state.freq - s.f);
    if (d<dmin){dmin=d; best=s;}
  }
  return {station:best, dist:dmin};
}
function signalStrength(){
  const {dist} = nearestStation();
  const s = Math.max(0, 1 - dist/0.6); // wider capture range
  return Math.min(1, s);
}
function updateMeta(){
  const {station, dist} = nearestStation();
  const sig = Math.round(signalStrength()*100);
  state.near = (sig>55)? station : null;
  els.sig.textContent = sig+"%";
  els.freq.textContent = state.freq.toFixed(1)+" MHz";
  els.name.textContent = state.near? station.name : "scanning‚Ä¶";
  // tone sweeps toward a pitch when near
  if (ac){
    const base = 180 + (state.freq-88)*14;
    const lock = state.near ? 420 : base;
    tone.frequency.setTargetAtTime(lock, ac.currentTime,.08);
  }
}

/* -------------------- TAP-TO-PREVIEW ONLY ----------------- */
const ui = {
  openPreview(st){
    els.pvTitle.textContent = st.name;
    els.pvFreq.textContent  = `${st.f.toFixed(1)} MHz`;
    els.pvVisit.href        = st.url;
    els.pvBox.textContent   = "preview locked ‚Äî tap Visit to jump";
    els.modal.style.display = 'flex';
  },
  closePreview(){ els.modal.style.display='none'; }
};
els.canvas.addEventListener('click',()=>{ if(state.near) ui.openPreview(state.near); });

/* buttons */
document.getElementById('btnTune').onclick = ()=> { /* nothing magic; kept for feel */ };
document.getElementById('btnPreview').onclick = ()=> { if(state.near) ui.openPreview(state.near); };
document.getElementById('btnWarp').onclick = ()=>{
  const pick = STATIONS[Math.floor(Math.random()*STATIONS.length)];
  els.dial.value = pick.f; state.freq = pick.f; updateMeta();
};

els.dial.oninput = e=>{ state.freq = parseFloat(e.target.value); updateMeta(); };

/* keyboard helpers */
addEventListener('keydown',e=>{
  if (e.key==='?') alert('operator note: ‚ÄúUndefined behavior is indistinguishable from art.‚Äù');
  if (e.key==='b'){ setConscious(!state.conscious); }
});

/* ---------------------- ARTIFACT ACTIONS ------------------ */
const effects = {
  degauss(){
    // bright flash + wobble
    const w=els.canvas.width/devicePixelRatio,h=els.canvas.height/devicePixelRatio;
    ctx.save(); ctx.globalCompositeOperation='screen';
    const g=ctx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h)/2);
    g.addColorStop(0,'rgba(255,255,255,.8)'); g.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle=g; ctx.fillRect(0,0,w,h); ctx.restore();
    if (ac){ tone.frequency.setTargetAtTime(80,ac.currentTime,.01); setTimeout(()=>tone.frequency.setTargetAtTime(420,ac.currentTime,.15),120);}
  },
  centerDial(){ const target = Math.round(state.freq)+.5; els.dial.value=target; state.freq=target; updateMeta(); },
  colorBars(){ const s=STATIONS.find(x=>x.pattern==='bars'); state.freq=s.f; els.dial.value=s.f; updateMeta(); },
  shortwave(){ setAudio(true); if (ac) tone.type='triangle'; setTimeout(()=>tone.type='sine', 2400); }
};

/* ------------------------ MAIN LOOP ----------------------- */
function tick(){ t++; drawCRT(); requestAnimationFrame(tick); }
updateMeta(); setAudio(false); setConscious(false); tick();

/* visibility: cancel any pending preview timers (defensive) */
document.addEventListener('visibilitychange',()=>{
  // no timers anymore; kept in case we add hold-to-preview later
  state.lastFocus = Date.now();
});
</script>
</body>
</html>
